<div class="post-container" *ngIf="post">
  <div class="post-header">
    <div class="user" [routerLink]="[URLS.THREAD_FN(post.thread?.id ?? 0)]">
      <mat-icon>{{ post.days_to_live ? 'schedule' : 'account_circle' }}</mat-icon>
      {{ !!post.thread?.name ? (post.sender_fingerprint | alias) + ' @ ' + post.thread?.name : (post.sender_fingerprint | alias) }}
    </div>

    <mat-icon class="menu" *ngIf="isOwn | async" [matMenuTriggerFor]="menu">more_vert</mat-icon>
    <mat-menu #menu="matMenu">
      <button mat-menu-item (click)="deletePost()">Delete</button>
    </mat-menu>
  </div>
  <div class="post-image-container">
    <img class="post-image" [appBlur]="post.nsfw" [appBlurOverlay]="blurry" [src]="post.imageUrl" alt="">
  </div>
  <div class="post-message">
    <div>
      <div>
        <b>{{ (post.sender_fingerprint | alias) }} </b> <span class="message" *ngIf="post.decryptedMessage"
                                                              [innerHTML]="post.decryptedMessage | link "></span>
      </div>
      <span class="date">{{ post.created_at | date: "dd.MM HH:mm" }}</span>
    </div>
    <button *ngIf="!(isOwn|async); else ownLikes" mat-icon-button (click)="likePost()">
      <mat-icon>{{ (isLiked|async) ? 'favorite' : 'favorite_outline' }}</mat-icon>
    </button>
  </div>
  <app-comments-view [post]="post"></app-comments-view>
</div>


<ng-template #blurry>
  <mat-icon>local_fire_department</mat-icon>
</ng-template>
<ng-template #ownLikes>
  <span>
    <mat-icon [matBadgeHidden]="post.likes?.length == 0" [matBadge]="post.likes.length" [matMenuTriggerFor]="menu">favorite</mat-icon>
  </span>
</ng-template>
<mat-menu #menu="matMenu">
  <button mat-menu-item *ngFor="let liker of post.likes">
    {{ liker.userFingerprint | alias }}
  </button>
</mat-menu>
